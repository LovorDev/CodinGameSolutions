using System.Collections.Generic;

namespace SummerChallenge2023
{
    public class ExploitingSuperpowers_4
    {
        /**
         * @param instructions The list of instructions as memorized by the mutant.
         * @param target The coordinates (x, y) of the target.
         * @return A string respecting the given format to fix the mutant's path.
         */
        public static string FindCorrectPath(List<string> instructions, List<int> target)
        {
            // Write your code here
            for (var i = 0; i < instructions.Count; i++)
            {
                var inst = new List<string>(instructions);
                foreach (var command in new[] { "FORWARD", "BACK", "TURN LEFT", "TURN RIGHT" })
                {
                    inst[i] = command;
                    var check = CheckPath(inst, target);
                    if (check)
                    {
                        return $"Replace instruction {i} with {command}";
                    }
                }
            }

            return string.Join(' ', instructions);
        }

        private static bool CheckPath(List<string> instructions, List<int> target)
        {
            var directionIndex = 0;
            (int x, int y) position = (0, 0);
            var directions = new[] { (1, 0), (0, -1), (-1, 0), (0, 1) };

            foreach (var inst in instructions)
            {
                (int turn, int move) command = inst switch
                {
                    "FORWARD" => (0, 1),
                    "BACK" => (0, -1),
                    "TURN LEFT" => (3, 0),
                    "TURN RIGHT" => (1, 0),
                };
                directionIndex = (directionIndex + command.turn) % 4;
                var dir = directions[directionIndex];
                position = (position.x + dir.Item1 * command.move, position.y + dir.Item2 * command.move);
            }

            return position.x == target[0] && position.y == target[1];
        }
    }
}